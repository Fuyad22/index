<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MU Chatrodol Post</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            color-scheme: light;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f9fafb;
            color: #0f172a;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header.post-header {
            padding: 1.5rem clamp(1.5rem, 4vw, 4rem);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(15, 23, 42, 0.9);
            color: white;
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.25);
        }

        header.post-header .brand {
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            text-decoration: none;
            color: inherit;
            font-weight: 600;
        }

        .back-link::before {
            content: '\2190';
        }

        main {
            flex: 1;
            padding: clamp(2rem, 5vw, 4rem);
            display: flex;
            justify-content: center;
        }

        .post-detail {
            max-width: 820px;
            width: 100%;
            background: white;
            border-radius: 28px;
            padding: clamp(2rem, 4vw, 3rem);
            box-shadow: 0 30px 80px rgba(15, 23, 42, 0.12);
            display: grid;
            gap: 1.5rem;
        }

        .post-figure {
            margin: 0;
            border-radius: 22px;
            overflow: hidden;
            aspect-ratio: 16 / 9;
            background: #0f172a;
        }

        .post-figure img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .post-meta {
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            color: #0ea5e9;
            font-weight: 600;
        }

        h1.post-title {
            margin: 0;
            font-size: clamp(2rem, 4vw, 2.7rem);
            line-height: 1.2;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.92), rgba(30, 41, 59, 0.92));
            color: #f8fafc;
            padding: clamp(0.75rem, 2vw, 1.1rem) clamp(1rem, 2.5vw, 1.75rem);
            border-radius: 20px;
            box-shadow: 0 18px 36px rgba(15, 23, 42, 0.18);
        }

        .post-summary {
            margin: 0;
            color: #475569;
            font-size: 1.08rem;
            line-height: 1.7;
        }

        .post-body {
            display: grid;
            gap: 1.1rem;
        }

        .post-body p {
            margin: 0;
            color: #334155;
            line-height: 1.9;
            font-size: 1.02rem;
        }

        .empty-state {
            text-align: center;
            padding: clamp(3rem, 6vw, 5rem);
            display: grid;
            gap: 1rem;
        }

        .empty-state h1 {
            margin: 0;
            font-size: clamp(2rem, 4vw, 2.6rem);
        }

        .empty-state p {
            margin: 0;
            color: #64748b;
            font-size: 1.05rem;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: #64748b;
            font-size: 0.95rem;
        }

        @media (max-width: 640px) {
            header.post-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }

            main {
                padding: 1.5rem;
            }

            .post-detail {
                padding: 1.75rem;
            }
        }
    </style>
</head>
<body>
    <header class="post-header">
        <a class="back-link" href="index.html#home">Back</a>
        <span class="brand">MU Chatrodol</span>
    </header>

    <main>
        <article class="post-detail" id="postView" hidden>
            <figure class="post-figure" id="detailImageWrapper" hidden>
                <img id="detailImage" alt="">
            </figure>
            <div class="post-meta" id="detailDate"></div>
            <h1 class="post-title" id="detailTitle"></h1>
            <p class="post-summary" id="detailSummary"></p>
            <div class="post-body" id="detailBody"></div>
        </article>
    </main>

    <section class="empty-state" id="postFallback" hidden>
        <h1></h1>
        <p></p>
        <a class="back-link" href="index.html#home">Browse Latest Updates</a>
    </section>

    <footer>
        &copy; 2025 MU Chatrodol Student Organization
    </footer>

    <script src="site-data.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const postId = params.get('id');

        console.log('Post ID from URL:', postId);

        const dataModule = window.MUChatrodolData || {};
        const storageKey = dataModule.STORAGE_KEY || 'mu-chatrodol-cms/v1';
        const getDefaults = typeof dataModule.getDefaultData === 'function'
            ? () => dataModule.getDefaultData()
            : () => ({ posts: [] });

        const safeClone = (value) => JSON.parse(JSON.stringify(value || []));

        const loadPosts = () => {
            const defaults = getDefaults();
            let stored = null;

            if (typeof window.localStorage !== 'undefined') {
                try {
                    const raw = window.localStorage.getItem(storageKey);
                    if (raw) {
                        stored = JSON.parse(raw);
                    }
                } catch (error) {
                    console.warn('Unable to read stored posts', error);
                }
            }

            const posts = Array.isArray(stored?.posts) ? stored.posts : defaults.posts;
            console.log('Available posts:', posts);
            return safeClone(posts);
        };

        const dateFormatter = new Intl.DateTimeFormat(undefined, { month: 'long', day: 'numeric', year: 'numeric' });

        const formatDate = (value) => {
            if (!value) {
                return '';
            }
            try {
                const date = new Date(value);
                if (Number.isNaN(date.getTime())) {
                    return value;
                }
                return dateFormatter.format(date);
            } catch (error) {
                return value;
            }
        };

        const renderParagraphs = (container, text) => {
            container.innerHTML = '';
            if (!text || !text.trim()) {
                return;
            }
            const blocks = text.split(/\n{2,}/).map(block => block.trim()).filter(Boolean);
            if (!blocks.length) {
                const paragraph = document.createElement('p');
                paragraph.textContent = text.trim();
                container.appendChild(paragraph);
                return;
            }
            blocks.forEach(block => {
                const paragraph = document.createElement('p');
                paragraph.textContent = block;
                container.appendChild(paragraph);
            });
        };

        const posts = loadPosts();
        const post = posts.find(entry => entry.id === postId);

        const postView = document.getElementById('postView');
        const fallbackView = document.getElementById('postFallback');
        const detailImageWrapper = document.getElementById('detailImageWrapper');
        const detailImage = document.getElementById('detailImage');
        const detailDate = document.getElementById('detailDate');
        const detailTitle = document.getElementById('detailTitle');
        const detailSummary = document.getElementById('detailSummary');
        const detailBody = document.getElementById('detailBody');

        if (!postId || !post) {
            document.title = 'Post Not Found | MU Chatrodol';
            if (fallbackView) {
                fallbackView.hidden = false;
            }
            if (postView) {
                postView.hidden = true;
            }
        } else {
            document.title = `${post.title || 'Community Update'} | MU Chatrodol`;

            const hasImage = Boolean(post.image && post.image.trim());
            if (hasImage && detailImageWrapper && detailImage) {
                detailImageWrapper.hidden = false;
                detailImage.src = post.image;
                detailImage.alt = post.imageAlt || `${post.title || 'Community update'} illustration`;
            }

            if (detailDate) {
                detailDate.textContent = formatDate(post.date);
            }
            if (detailTitle) {
                detailTitle.textContent = post.title || 'Community Update';
            }

            const summaryText = post.summary && post.summary.trim() ? post.summary.trim() : '';
            if (detailSummary) {
                if (summaryText) {
                    detailSummary.hidden = false;
                    detailSummary.textContent = summaryText;
                } else {
                    detailSummary.hidden = true;
                    detailSummary.textContent = '';
                }
            }

            const bodySource = post.content && post.content.trim() ? post.content : summaryText;
            if (detailBody) {
                renderParagraphs(detailBody, bodySource || '');
            }

            if (postView) {
                postView.hidden = false;
            }
            if (fallbackView) {
                fallbackView.hidden = true;
            }
        }
    </script>
</body>
</html>
